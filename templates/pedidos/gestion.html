{% extends 'base.html' %}
{% load humanize %}
{% block content %}
<h3>Gesti√≥n de pedidos</h3>
<table class="table table-striped align-middle">
  <thead>
    <tr>
      <th>#</th>
      <th>Fecha</th>
      <th>Cliente</th>
      <th>Estado</th>
      <th class="text-end">Total</th>
      <th class="text-end">Acciones</th>
    </tr>
  </thead>
  <tbody>
  {% for p in pedidos %}
    <tr>
      <td>{{ p.id }}</td>
      <td>{{ p.fecha_pedido|date:'d-m-Y H:i' }}</td>
      <td>{{ p.cliente.nombre }}</td>
      <td>
        <form action="{% url 'pedidos:cambiar_estado' p.id %}" method="post" class="d-flex gap-2">
          {% csrf_token %}
          <select name="estado" class="form-select form-select-sm">
            {% for e in estados %}
              <option value="{{ e }}" {% if p.estado == e %}selected{% endif %}>{{ e }}</option>
            {% endfor %}
          </select>
          <button class="btn btn-sm btn-primary" type="submit">Actualizar</button>
        </form>
      </td>
      <td class="text-end">$ {{ p.total|intcomma }}</td>
      <td class="text-end">
        <a class="btn btn-sm btn-outline-secondary" href="{% url 'pedidos:comprobante_pdf' p.id %}" target="_blank">Comprobante</a>
      </td>
    </tr>
  {% empty %}
    <tr><td colspan="6">No hay pedidos.</td></tr>
  {% endfor %}
  </tbody>
</table>
{% endblock %}
