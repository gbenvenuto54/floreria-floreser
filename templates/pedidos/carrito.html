{% extends 'base.html' %}
{% load humanize %}
{% block content %}
<h3>Carrito</h3>
<table class="table align-middle">
  <thead>
    <tr>
      <th>Producto</th><th class="text-end">Precio</th><th class="text-center">Cant.</th><th class="text-end">Total</th><th></th>
    </tr>
  </thead>
  <tbody>
  {% for it in items %}
    <tr>
      <td>{{ it.producto.nombre }}</td>
      <td class="text-end">$ {{ it.precio|intcomma }}</td>
      <td class="text-center">
        <form action="{% url 'pedidos:carrito_actualizar' it.producto.id %}" method="post" class="d-inline-flex gap-2">
          {% csrf_token %}
          <input type="number" class="form-control" name="cantidad" min="1" value="{{ it.cantidad }}" style="width:90px">
          <button class="btn btn-sm btn-primary" type="submit">Actualizar</button>
        </form>
      </td>
      <td class="text-end">$ {{ it.total|intcomma }}</td>
      <td class="text-end">
        <a href="{% url 'pedidos:carrito_eliminar' it.producto.id %}" class="btn btn-sm btn-outline-danger">Eliminar</a>
      </td>
    </tr>
  {% empty %}
    <tr><td colspan="5">El carrito está vacío.</td></tr>
  {% endfor %}
  </tbody>
  <tfoot>
    <tr><th colspan="3" class="text-end">Subtotal</th><th class="text-end">$ {{ subtotal|intcomma }}</th><th></th></tr>
    <tr><th colspan="3" class="text-end">IVA (19%)</th><th class="text-end">$ {{ iva|intcomma }}</th><th></th></tr>
    <tr><th colspan="3" class="text-end">Total</th><th class="text-end">$ {{ total|intcomma }}</th><th></th></tr>
  </tfoot>
</table>
<div class="d-flex gap-2">
  <a class="btn btn-outline-secondary" href="{% url 'productos:lista' %}">Seguir comprando</a>
  <a class="btn btn-success" href="{% url 'pedidos:checkout' %}">Ir a pagar</a>
</div>
{% endblock %}
